<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="favicon.ico">
  <title>Catálogo | Vinyl Lab</title>

  <!-- usa TU css real -->
  <link rel="stylesheet" href="styles/styles.css" />
  <link rel="stylesheet" href="styles/login.css" />
</head>

<body>
  <header class="main-header">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="header-left d-flex align-items-center">
        <img src="imagenes/VinylLab.png" alt="Logo Vinyl Lab" class="header-logo me-2">
        <img src="https://vinyl-lab-production-ccc7.up.railway.app/uploads/vinilo_forever.jpg" alt="">

        <h1 class="header-title">Vinyl Lab</h1>
      </div>

      <div class="d-flex align-items-center gap-2">
        <a href="login.html" class="btn-login-custom">Iniciar sesión</a>
        <a href="index.html" class="btn-login-custom">Inicio</a>
      </div>
    </div>
  </header>

  <main class="main-content container py-5">
    <h2 class="mb-4 text-center">Catálogo de Vinilos</h2>

    <div id="estado" class="alert alert-info text-center"></div>

    <div id="grid" class="row g-4"></div>
  </main>

  <footer class="footer mt-5 pt-5 pb-4">
    <div class="container">
      <div class="text-center mt-4 border-top pt-3 small footer-copy">
        &copy; 2026 Vinyl Lab — Todos los derechos reservados.
      </div>
    </div>
  </footer>

  <script>
  const API_BASE = "https://vinyl-lab-production-ccc7.up.railway.app";

  fetch(`${API_BASE}/api/vinilos`)
    .then(r => r.json())
    .then(data => console.log(data));

  const grid = document.getElementById("grid");
  const estado = document.getElementById("estado");

  function showMsg(msg) {
    estado.style.display = "block";
    estado.textContent = msg;
  }

  function cardVinilo(v) {
    const precio = Number(v.precio).toLocaleString("es-ES", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });

    // Si en la BD viene "uploads/xxx.jpg" -> queda "https://.../uploads/xxx.jpg"
    const imgSrc = v.imagen ? `${API_BASE}/${String(v.imagen).replace(/^\/+/, "")}` : "";

    return `
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <div class="card h-100 shadow-sm" style="background-color: rgba(255,255,255,0.9); border: none;">
          ${imgSrc ? `
            <img
              src="${imgSrc}"
              class="card-img-top"
              alt="${(v.nombre || "Vinilo").replace(/"/g, "&quot;")}"
              loading="lazy"
              onerror="this.onerror=null;this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22250%22%3E%3Crect fill=%22%23ddd%22 width=%22400%22 height=%22250%22/%3E%3Ctext fill=%22%23999%22 x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22%3ESin imagen%3C/text%3E%3C/svg%3E'">
          ` : ``}

          <div class="card-body d-flex flex-column">
            <h5 class="card-title" style="font-family:'Bebas Neue', sans-serif;">${v.nombre ?? "Sin nombre"}</h5>
            ${v.artista ? `<p class="card-text text-muted mb-2"><small>${v.artista}</small></p>` : ``}
            <p class="card-text mb-2"><strong>${precio} €</strong></p>
          </div>
        </div>
      </div>
    `;
  }

  async function cargar() {
    try {
      showMsg("Cargando catálogo...");

      const res = await fetch(`${API_BASE}/api/vinilos`, { cache: "no-store" });
      const data = await res.json();

      // Soporta dos formatos:
      // 1) { ok:true, vinilos:[...] }
      // 2) [...] (array directo)
      const vinilos = Array.isArray(data) ? data : (data.vinilos || []);
      const ok = Array.isArray(data) ? true : !!data.ok;

      if (!res.ok || !ok) {
        showMsg(data?.message || "No se pudo cargar el catálogo");
        return;
      }

      estado.style.display = "none";
      grid.innerHTML = vinilos.map(cardVinilo).join("");
    } catch (e) {
      console.error(e);
      showMsg("No se pudo conectar con el servidor (Railway).");
    }
  }

  cargar();
</script>

</body>

</html>